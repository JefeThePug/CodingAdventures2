{% extends "admin/iframe.html" %}

{% block content %}
<section>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for _, message in messages %}
    <p class="b alert">{{ message }}</p>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <form action="admin/html" method="POST">
        <h2>Year and Week</h2>
        <hr>
        <div class="form-group">
            <label for="year">Challenge Year:</label>
            <select id="year" name="year" onchange="updateLocation()">

                {% for y in years %}
                <option value="{{ y }}" {{
                'selected' if y == selected_year }}>{{ y }}</option>
                {% endfor %}
            </select>
            <label for="week">Week Number:</label>
            <select id="week" name="week" onchange="updateLocation()">
                {% for w in range(1, 11) %}
                <option value="{{ w }}" {{
                'selected' if w == selected_week }}>Week {{ w }}</option>
                {% endfor %}
            </select>
        </div>
        <p class="indent alert"> ‼️Changing the year/week will discard any unsaved ID changes.</p>

        {% for part, p in [(1, 'a'), (2, 'b')] %}
        <h2>Part {{ part }}</h2>
        <hr>
        {% for field, size in [
        ('title', 1), ('content', 10), ('instructions', 5), ('input', 1), ('form', 7), ('solution', 7)
        ] %}
        <div class="form-group">
            {% set label = "{{ selected_year }}_{{ selected_week }}_{{ p }}_{{ field }}" %}
            <label for="{{ label }}">{{ field | capitalize }}:</label>
            <textarea id="{{ label }}" name="{{ label }}" rows="{{ size }}" class="full"
                      cols="90">{{ data[selected_year][selected_week][part][field] }}</textarea>
        </div>
        {% endfor %}
        {% endfor %}
        <hr>

        <div class="indent actions">
            <input type="button" value="CANCEL" onclick="updateLocation()">
            <input type="submit" value="SAVE">
        </div>
    </form>
</section>

<script>
    function updateLocation() {
        const year = document.getElementById('year').value;
        const week = document.getElementById('week').value;
        window.location.href = "{{ url_for('admin.html') }}?year=" + year + "&week=" + week;
    }
</script>
{% endblock %}
